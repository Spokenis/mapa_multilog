<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Rotas | Multilog Itajaí</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.79.0/dist/L.Control.Locate.min.css" />

    <style>
        :root {
            --multilog-navy: #202644;
            --multilog-orange: #ee7d08;
            --white: #FFFFFF;
            --light-gray: #f0f2f5;
            --text-dark: #333;
            --border-gray: #e0e0e0;
        }
        body { margin: 0; font-family: 'DM Sans', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: var(--multilog-navy); }
        .container { width: 95%; max-width: 1400px; height: 90vh; display: flex; flex-direction: column; border: 1px solid var(--border-gray); box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-radius: 8px; overflow: hidden; background-color: var(--multilog-navy); }
        .search-bar { padding: 12px 20px; background-color: var(--white); border-bottom: 1px solid var(--border-gray); display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .logo-container { display: flex; align-items: center; }
        .logo-svg { height: 30px; width: auto; color: var(--multilog-navy); }
        .search-controls { display: flex; flex-grow: 1; min-width: 280px; }
        #search-input { flex-grow: 1; padding: 10px 15px; border: 1px solid var(--border-gray); border-radius: 6px 0 0 6px; font-size: 1rem; border-right: none; }
        #search-input:focus { outline: none; border-color: var(--multilog-orange); }
        #search-button { padding: 10px 22px; border: 1px solid var(--multilog-orange); background-color: var(--multilog-orange); color: var(--white); font-weight: 500; font-size: 1rem; border-radius: 0 6px 6px 0; cursor: pointer; }
        .map-header { padding: 8px 20px; text-align: center; background-color: #fafafa; display: flex; justify-content: space-between; align-items: center; }
        .map-header h1 { margin: 0; font-size: 1.25rem; font-weight: 500; color: var(--text-dark); flex-grow: 1; text-align: center; }
        #mapa { flex-grow: 1; height: 100%; border-top: 1px solid var(--border-gray); }
        
        @media (max-width: 600px) {
            .container { height: 100vh; width: 100%; border-radius: 0; border: none; }
            .logo-container { display: none; }
            .search-bar { padding: 8px; }
            .map-header h1 { font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="search-bar">
            <div class="logo-container">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 532.7 151" class="logo-svg" xml:space-preserve"><polygon fill="currentColor" points="363,126.7 394.3,126.7 394.3,139.4 348.6,139.4 348.6,63.3 363,63.3 "/><path fill="currentColor" d="M457.8,117.1c0,12.7-7.3,23.4-28.8,23.4c-21.5,0-28.8-10.7-28.8-23.4V85.6c0-12.7,7.3-23.4,28.8-23.4  c21.5,0,28.8,10.7,28.8,23.4V117.1z M414.6,116.3c0,7.2,3.7,11.5,14.4,11.5c10.7,0,14.4-4.3,14.4-11.5V86.4 c0-7.2-3.7-11.5-14.4-11.5c-10.7,0-14.4,4.3-14.4,11.5V116.3z"/><path fill="currentColor" d="M479.7,115.9c0,7.4,3.2,11.8,13.3,11.8c3.9,0,7.9-0.3,11.8-0.9v-23.1h13.6v33.5c-8,2.3-17.5,3.4-25.5,3.4  c-18.6,0-27.5-7.9-27.5-23V85.1c0-15.7,9.1-23,28.9-23c6.2,0,15,0.7,21.8,2.5l-1.6,12.6c-7-1.5-13.9-2.1-21.4-2.1    c-10.1,0-13.4,4.1-13.4,11.9V115.9z"/><rect x="286.3" y="118.7" fill="currentColor" width="48.4" height="20.8"/><rect x="286.3" y="91" fill="currentColor" width="48.4" height="20.8"/><rect x="286.3" y="63.3" fill="currentColor" width="48.4" height="20.8"/><rect x="286.3" y="35.6" fill="currentColor" width="48.4" height="20.8"/><rect x="286.3" y="7.9" fill="currentColor" width="48.4" height="20.8"/><polygon fill="currentColor" points="62.8,129.6 44.5,129.6 30.4,90.1 29.2,139.4 14.4,139.4 17.9,63.3 34,63.3 53.6,117.3 73.3,63.3    89.4,63.3 92.8,139.4 78.1,139.4 76.8,90.1 "/><path fill="currentColor" d="M155.4,63.3v54.1c0,12-6.7,23.2-28.1,23.2c-21.4,0-28.1-11.2-28.1-23.2V63.3h14.4v52.9    c0,7.4,3.5,11.7,13.7,11.7c10.2,0,13.7-4.2,13.7-11.7V63.3H155.4z"/><polygon fill="currentColor" points="176.9,126.7 208.2,126.7 208.2,139.4 162.4,139.4 162.4,63.3 176.9,63.3 "/><polygon fill="currentColor" points="215.1,76 193.9,76 193.9,63.3 250.8,63.3 250.8,76 229.5,76 229.5,139.4 215.1,139.4 "/><rect x="258" y="63.3" fill="currentColor" width="14.4" height="76.1"/></svg>
            </div>
            <div class="search-controls">
                <input type="text" id="search-input" placeholder="Pesquisar por 'AZ1 DC1', 'ENTRADA'...">
                <button id="search-button">Pesquisar</button>
            </div>
        </div>
        <div class="map-header">
            <h1>Itajaí</h1>
        </div>
        <div id="mapa"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.79.0/dist/L.Control.Locate.min.js"></script>

    <script>
        const ruas = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 });
        const satelite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { maxZoom: 18 });

        const bounds = L.latLngBounds([[-26.958, -48.752], [-26.950, -48.748]]);
        const mapa = L.map('mapa', {
            center: [-26.9535, -48.7500],
            zoom: 17,
            layers: [ruas],
            maxBounds: bounds,
            minZoom: 16
        });

        const baseMaps = { "Ruas": ruas, "Satélite": satelite };
        L.control.layers(baseMaps).addTo(mapa);

        let todasAsRotas = [];
        let todosOsPontos = [];
        let camadaRotaAtual = null;

        const guaritaIcon = L.icon({ iconUrl: 'guarita.png', iconSize: [68, 28], iconAnchor: [19, 38] });
        const docaIcon = L.icon({ iconUrl: 'doca.png', iconSize: [25, 25], iconAnchor: [16, 32] });
        const startPoint = L.latLng(-26.951650, -48.750924);
        L.marker(startPoint, { icon: guaritaIcon, title: 'Guarita' }).addTo(mapa);

        fetch('rotas.geojson')
            .then(response => response.json())
            .then(data => {
                todasAsRotas = data.features.filter(f => f.properties.type === 'route');
                todosOsPontos = data.features.filter(f => f.properties.type === 'point');
                console.log(`Carregado: ${todasAsRotas.length} rotas e ${todosOsPontos.length} pontos.`);
                
                L.geoJSON(todosOsPontos, {
                    pointToLayer: (feature, latlng) => L.marker(latlng, { icon: docaIcon, title: feature.properties.name }),
                    onEachFeature: (feature, layer) => {
                        layer.bindPopup(`<b>${feature.properties.name}</b>`);
                        if(feature.properties.zone){
                             layer.on('click', () => desenharRota(feature.properties.zone));
                        }
                    }
                }).addTo(mapa);
            })
            .catch(error => console.error("Erro ao carregar rotas.geojson:", error));

        function desenharRota(nomeDaZona) {
            if (camadaRotaAtual) mapa.removeLayer(camadaRotaAtual);
            const rotaFeature = todasAsRotas.find(f => f.properties.name.toUpperCase() === nomeDaZona.toUpperCase());
            if (rotaFeature) {
                const rotaComGuarita = JSON.parse(JSON.stringify(rotaFeature));
                rotaComGuarita.geometry.coordinates.unshift([startPoint.lng, startPoint.lat]);
                camadaRotaAtual = L.geoJSON(rotaComGuarita, { style: { color: '#ee7d08', weight: 5, opacity: 0.7 } }).addTo(mapa); // Rota agora em laranja para melhor contraste
                mapa.fitBounds(camadaRotaAtual.getBounds().pad(0.1));
            } else {
                alert(`Não há uma rota principal definida para a zona: ${nomeDaZona}.`);
            }
        }
        
        L.control.locate({ flyTo: true, showCompass: false, strings: { title: "Mostrar minha localização" } }).addTo(mapa).start();
        
        function performSearch() {
            if (!todosOsPontos.length) return;
            const query = document.getElementById('search-input').value.trim().toUpperCase();
            if (!query) return;
            const result = todosOsPontos.find(p => p.properties.name.toUpperCase() === query);
            if (result && result.properties.zone) {
                desenharRota(result.properties.zone);
            } else {
                alert(`Ponto não encontrado: "${query}"`);
            }
        }
        document.getElementById('search-button').addEventListener('click', performSearch);
        document.getElementById('search-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') performSearch(); });
    </script>
</body>


</html>
